unit uProdutos;

interface

uses FireDAC.Comp.Client, Data.DB;

type
    TProdutos = class

    private

    fcodigo     : integer;
    fdescricao  : String;
    fvalor      : Double;
    festoque    : Double;

    public

    property codigo     : integer  read fcodigo     write fcodigo;
    property descricao  : String   read fdescricao  write fdescricao;
    property valor      : Double   read fvalor      write fvalor;
    property estoque    : double   read festoque    write festoque;

    function BuscaProduto(codigo: integer): Boolean;
    function AddProduto(sdescricao: string; dvalor, destoque: double): Boolean;
end;


implementation

{ TClientes }

uses udmPrincipal;


{ TProdutos }

function TProdutos.BuscaProduto(codigo: integer): Boolean;
Var qryBusca : TFDQuery;
begin
  qryBusca := TFDQuery.Create(Nil);
  qryBusca.Connection := dmPrincipal.CONEXAO;

  with qryBusca do
    Begin
      Close;
      SQL.Clear;
      SQL.Add('SELECT');
      SQL.Add('codigo AS Codigo,');
      SQL.Add('descricao AS Descrição,');
      SQL.Add('valor AS VUnit,');
      SQL.Add('estoque AS Estoque');
      SQL.Add('FROM tab_produtos');
      SQL.Add('WHERE codigo = :codigo');
        Params.ParamByName('codigo').AsInteger := codigo;
      Open;

      codigo    := qryBusca.FieldByName('Codigo').AsInteger;
      descricao := qryBusca.FieldByName('Descrição').AsString;
      valor     := qryBusca.FieldByName('VUnit').AsFloat;
      estoque   := qryBusca.FieldByName('Estoque').AsFloat;
    End;

  qryBusca.Free;
end;

function TProdutos.AddProduto(sdescricao:string; dvalor,destoque:double): Boolean;
Var qryBusca : TFDQuery;
begin
  qryBusca := TFDQuery.Create(Nil);
  qryBusca.Connection := dmPrincipal.CONEXAO;

  with qryBusca do
    Begin
      Close;
      SQL.Clear;
      SQL.Add('INSERT INTO tab_produtos (descricao, valor, estoque)');
      SQL.Add('VALUES (:descricao, :valor, :estoque) RETURNING codigo');
        Params.ParamByName('descricao').AsString := sdescricao;
        Params.ParamByName('valor').AsString := dvalor;
        Params.ParamByName('estoque').AsString := destoque;
      Open;

      codigo := qryBusca.FieldByName('codigo').AsInteger;
    End;

  qryBusca.Free;
end;

end.
